var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,a){var n,a=a||200;return function(){var e=this,i=arguments;clearTimeout(n),n=setTimeout(function(){t.apply(e,Array.prototype.slice.call(i))},a)}},SVIFT.helper.interpolate=function(t){var a={};a.def=t,a.interpolate=[],a.duration=0;for(var n=1;a.def.length>n;n++)"ease"in a.def[n]||(a.def[n].ease=!1),a.interpolate.push(d3.interpolate(a.def[n-1].value,a.def[n].value)),a.duration+=a.def[n].duration;for(var e=0,n=1;a.def.length>n;n++)a.def[n].duration=a.def[n].duration/a.duration,a.def[n].start=e,e+=a.def[n].duration;return a.i=function(t){for(var n=1;a.def.length>n;n++)if(t>=a.def[n].start&&a.def[n].start+a.def[n].duration>=t)return a.def[n].ease?a.interpolate[n-1](a.def[n].ease((t-a.def[n].start)/a.def[n].duration)):a.interpolate[n-1]((t-a.def[n].start)/a.def[n].duration)},a.i},SVIFT.helper.switchCol=function(t,a,n){return t.forEach(function(t){var e=t[a];t[a]=t[n],t[n]=e}),t},SVIFT.helper.transpose=function(t){var a={};return t.forEach(function(t){for(var n in t)n in a||(a[n]=[])}),t.forEach(function(t){for(var n in a)n in t?a[n].push(t[n]):a[n].push(null)}),a},SVIFT.vis={},SVIFT.vis.base=function(t,a){var n={};return n.data=t,n.container=a,n.g=null,n.svg=null,n.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20}},n.timeline={},n.init=function(){n.svg=n.container.append("svg").attr("width","100%").attr("height","100%").style("background-color","#ffffff"),n.defs=n.svg.append("defs"),n.g=n.svg.append("g").attr("transform","translate("+n.config.margin.top+","+n.config.margin.left+")");for(var t in n.timeline){var a=n.timeline[t];a.end>n.playTime&&(n.playTime=a.end)}n.time.step=n.playTime/(n.playTime/1e3*n.time.fps),n.playHead=0,n.setup(),n.resize(),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){n.resize()},200))},n.setup=function(){},n.resize=function(){},n.draw=function(t){for(var a in n.timeline){var e=n.timeline[a];t>=e.start&&e.end>=t?e.func((t-e.start)/(e.end-e.start)):t>e.end&&e.func(1)}},n.playHead=0,n.playState=!1,n.playTime=0,n.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},n.play=function(){n.playState&&("function"==typeof window.callPhantom?(n.playHead+=n.time.step,n.playTime>=n.playHead?(n.draw(n.playHead),window.callPhantom({msg:"drawDone",playHead:n.playHead})):(n.playHead=n.playTime,n.draw(n.playHead),n.pause(),window.callPhantom({msg:"playDone"}))):(0===n.time.then&&(n.time.then=n.time.startTime=Date.now()),n.time.now=Date.now(),n.time.elapsed=n.time.now-n.time.then,n.playTime>=n.time.now-n.time.startTime?(window.requestAnimationFrame(n.play),n.time.elapsed>n.time.fpsInterval&&(n.time.then=n.time.now-n.time.elapsed%n.time.fpsInterval,n.playHead=n.time.now-n.time.startTime,n.draw(n.playHead))):(n.playHead=n.playTime,n.goTo(1),n.pause())))},n.start=function(){n.playState=!0,n.play()},n.pause=function(){n.playState=!1},n.goTo=function(t){n.playTime>=t&&(n.playHead=t*n.playTime,n.draw(n.playHead)),n.pause()},n},SVIFT.vis.barchart=function(t,a){var n=SVIFT.vis.base(t,a);return n.d3config={axisWidth:50,axisHeight:50,ease:d3.easeCubicInOut,wInterpolate:[]},n.setup=function(){t.data.data.forEach(function(t,a){var e=n.defs.append("linearGradient").attr("id","grad"+a).attr("x1","0%").attr("y1","0%").attr("y2","0%").attr("x2","100%").attr("spreadMethod","pad");e.append("stop").attr("offset","0%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1"),e.append("stop").attr("offset","100%").attr("stop-color","rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")").attr("stop-opacity","1")}),n.d3config.y=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),n.d3config.yAxis=d3.axisLeft(),n.d3config.x=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]),n.d3config.xAxis=d3.axisBottom(),n.d3config.gXAxis=n.g.append("g"),n.d3config.gYAxis=n.g.append("g").attr("transform","translate("+(n.d3config.axisWidth-1)+",0)"),n.d3config.bars=n.g.append("g").selectAll("rect").data(t.data.data).enter().append("rect").attr("x",n.d3config.axisWidth).style("stroke","transparent").style("fill",function(t,a){return'url("#grad'+a+'")'})},n.resize=function(){var a=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right-n.d3config.axisWidth,e=n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom-n.d3config.axisHeight;n.d3config.x.range([0,a]),n.d3config.y.range([0,e]),n.d3config.xAxis.scale(n.d3config.x),n.d3config.gXAxis.call(n.d3config.xAxis),n.d3config.yAxis.scale(n.d3config.y),n.d3config.gYAxis.call(n.d3config.yAxis),n.d3config.gXAxis.attr("transform","translate("+n.d3config.axisWidth+","+e+")"),n.d3config.bars.attr("y",function(t){return n.d3config.y(t[0])}).attr("height",n.d3config.y.bandwidth()),t.data.data.forEach(function(t,a){n.d3config.wInterpolate[a]=d3.interpolate(0,n.d3config.x(t[1]))}),n.drawBars(n.playHead/n.playTime)},n.drawBars=function(t){n.d3config.bars.attr("width",function(a,e){return n.d3config.wInterpolate[e](n.d3config.ease(t))})},n.timeline={bars:{start:0,end:3e3,func:n.drawBars}},n},SVIFT.vis.columnchart=function(t,a){var n=SVIFT.vis.base(t,a);return n.d3config={axisWidth:50,axisHeight:50,ease:d3.easeCubicInOut,yInterpolate:[],hInterpolate:[]},n.setup=function(){n.d3config.x=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),n.d3config.xAxis=d3.axisBottom().scale(n.d3config.x),n.d3config.y=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]),n.d3config.yAxis=d3.axisLeft().scale(n.d3config.y),n.d3config.gXAxis=n.g.append("g"),n.d3config.gYAxis=n.g.append("g").attr("transform","translate("+n.d3config.axisWidth+",0)"),n.d3config.bars=n.g.append("g").selectAll("rect").data(t.data.data).enter().append("rect").style("stroke","transparent").style("fill","#000")},n.resize=function(){var a=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right-n.d3config.axisWidth,e=n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom-n.d3config.axisHeight;n.d3config.x.range([0,a]),n.d3config.y.range([e,0]),n.d3config.xAxis.scale(n.d3config.x),n.d3config.gXAxis.call(n.d3config.xAxis),n.d3config.yAxis.scale(n.d3config.y),n.d3config.gYAxis.call(n.d3config.yAxis),n.d3config.gXAxis.attr("transform","translate("+n.d3config.axisWidth+","+e+")"),n.d3config.bars.attr("x",function(t){return n.d3config.x(t[0])+n.d3config.axisWidth}).attr("width",n.d3config.x.bandwidth()),t.data.data.forEach(function(t,a){n.d3config.yInterpolate[a]=d3.interpolate(e,n.d3config.y(t[1])),n.d3config.hInterpolate[a]=d3.interpolate(0,e-n.d3config.y(t[1]))}),n.drawBars(n.playHead)},n.drawBars=function(t){n.d3config.bars.attr("y",function(a,e){return n.d3config.yInterpolate[e](n.d3config.ease(t))}).attr("height",function(a,e){return n.d3config.hInterpolate[e](n.d3config.ease(t))})},n.timeline={bars:{start:0,end:3e3,func:n.drawBars}},n};